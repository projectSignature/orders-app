<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash Register</title>
    <link rel="stylesheet" href="../style/loading-popup.css">
    <link rel="stylesheet" href="../style/pos.css">
    <link rel="stylesheet" href="../style/comanda.css">
    <link rel="stylesheet" href="../style/common.css">
    <!-- <link rel="stylesheet" href="../style/appname.css"> -->
</head>
<style>
html{
  padding: 0px;
  margin: 0px
}
    body {
      font-family: sans-serif;
      padding: 0px;
      margin: 0px;
      background: #f7f7f7;
    height: 100vh;
  overflow: hidden;}

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 10px;
        background-color: #343a40;
        color: white;
        height: 10%
    }

    .logo-container {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
    }

    .logo {
        height: 20px;
        margin-right: 15px;
    }
    .kun-text {
    font-size: 2.5rem;
    font-weight: bold;
    color: #fff;
    font-family: 'Noto Sans JP', sans-serif;
}
    .orders-text {
        font-size: 2.5rem;
        font-weight: bold;
        color: #ff8c00;
        margin-right: 5px;
    }
    .header-buttons {
        display: flex;
    }

    .header-btn {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 2px 5px;
        margin-left: 10px;
        cursor: pointer;
        border-radius: 5px;
        width: 6rem;
        transition: background-color 0.3s ease;
        font-size: 20px!important
    }
    h2 { margin-top: 40px; }

    .label-container,.print-label,.label-container-sweet {
      width: 33%;
      display: flex;
      justify-content: space-around;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 10px;
    overflow-y: auto;}

    .label-item img {
  width: 150px;
  height: 100px;
  object-fit: contain; /* â†ç¸¦æ¨ªæ¯”ã‚’å´©ã•ãšå†…å´ã«åã‚ã‚‹ */
  background: #fff;
}

    .modal {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: white; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.2);
      display: none; z-index: 10;
      width:50%;
      height: 85%
    }
    .overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5); display: none; z-index: 5;
    }
    .print-label {
      border: 1px dashed #999; padding: 20px; background: white;
      width: 300px; margin-top: 10px;
    }
    .modal-content{
      display: block;
    }
    .modal-content p {
  font-size: 18px;
  margin-bottom: 10px;
}

.modal-content input {
  width: 80px;
  height: 40px;
  font-size: 18px;
  text-align: center;
  margin-bottom: 15px;
}

.modal-content button {
  padding: 10px 20px;
  font-size: 18px;
  margin: 5px;
  border: none;
  border-radius: 4px;
  background-color: #4285f4;
  color: white;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.modal-content button:hover {
  background-color: #306ac9;
}

.header-btn.active {
    /* background-color: orange; */
    color: white; /* æ–‡å­—è‰²ã‚‚å¤‰æ›´ */
}
.keypad {
  display: grid;
  grid-template-columns: repeat(3, 60px);
  gap: 10px;
  justify-content: center;
}

.keypad button {
  font-size: 20px;
  padding: 15px;
  border: none;
  background: #eee;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s;
}

.keypad button:hover {
  background: #ddd;
}
.main-div{
  width: :100%;
  height: 85%;
  display: flex;
  justify-content: space-between;

}

@media screen and (min-width: 1024px) and (max-width: 1966px) {
button {
    padding: 10px;
    margin-top: 1px;
    width: 100%;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 20px;
}
}

  </style>
<body>
    <header class="header">
      <div class="logo-container">
       <div class="logo-text">
            <span class="orders-text">Orders</span>
            <span class="kun-text">å›</span>
       </div>
      </div>
      <div class="header-buttons">
        <select id="language-select" class="lang-select">
          <option value="jp">æ—¥æœ¬èª</option>
          <option value="pt" selected>PortuguÃªs</option>
          <option value="en">English</option>
        </select>
          <button class="header-btn nav-btn" id="label-btn"style="background-color: orange;display:none">Label</button>
        <button class="header-btn nav-btn" id="pedido-admin-btn" data-i18n="pedido_admin">Pedido<br>Admin</button>

        <!-- <button class="header-btn nav-btn" id="pedido-client-btn" data-i18n="pedido_tablet">Pedido<br>tablet</button>
        <button class="header-btn nav-btn" id="pedido-takeout-btn" data-i18n="pedido_takeout">Pedido<br>takeout</button> -->
        <button class="header-btn nav-btn" id="comanda-btn" data-i18n="orders">Orders</button>
        <button class="header-btn nav-btn" id="reserva-btn" data-i18n="reservas">Reservas</button>
        <button class="header-btn nav-btn" id="reserva-hist-btn" data-i18n="reservas_historico">Reservas<br>(histÃ³rico)</button>
        <button class="header-btn nav-btn" id="pos-btn" data-i18n="pos">POS</button>
        <button class="header-btn nav-btn" id="menu-btn" data-i18n="menu">Menu</button>
        <button class="header-btn nav-btn" id="history-btn" data-i18n="historico_pedidos">HistÃ³rico<br>pedidos</button>
        <button class="header-btn nav-btn" id="logout-btn" data-i18n="logout">Logout</button>
      </div>
    </header>

    <div class="main-div">
      <div class="label-container" id="labelContainer">
      </div>
      <div class="label-container" id="labelContainer-sweet"></div>
   <div class="print-label">
     <label for="itemName">Tipo(ã‚¿ã‚¤ãƒ—é¸æŠ)</label><br>
     <select id="itemName" style="width: 100%; padding: 10px; margin-bottom: 10px;">
       <option value="Pastel de carne">Pastel de carneï¼ˆç‰›è‚‰ï¼‰</option>
       <option value="Pastel de queijo">Pastel de queijoï¼ˆãƒãƒ¼ã‚ºï¼‰</option>
       <option value="Pastel de pizza">Pastel de pizzaï¼ˆãƒ”ã‚¶ï¼‰</option>
       <option value="Pastel carne com queijo">Pastel carne com queijoï¼ˆç‰›ï¼‹ãƒãƒ¼ã‚ºï¼‰</option>
       <option value="Pastel frango com queijo">Pastel frango com queijoï¼ˆé¶ï¼‹ãƒãƒ¼ã‚ºï¼‰</option>
       <option value="Pastel de frango com catupiry">Pastel de frango com catupiryï¼ˆé¶ï¼‹ã‚«ãƒˆã‚¥ãƒ”ãƒªï¼‰</option>
       <option value="Pastel de palmito">Pastel de palmitoï¼ˆãƒ¤ã‚·ã®èŠ½ï¼‰</option>
       <option value="Pastel de carne seca com queijo">Pastel de carne seca com queijoï¼ˆå¹²ã—è‚‰ï¼‹ãƒãƒ¼ã‚ºï¼‰</option>
       <option value="Pastel de costela">Pastel de costelaï¼ˆã‚¹ãƒšã‚¢ãƒªãƒ–ï¼‰</option>
    ã€€ã€€<option value="Pastel de carne">Pastel de carneï¼ˆç‰›è‚‰ï¼‰</option>
       <option value="Pastel de queijo">Pastel de queijoï¼ˆãƒãƒ¼ã‚ºï¼‰</option>
       <option value="Pastel de pizza">Pastel de pizzaï¼ˆãƒ”ã‚¶ï¼‰</option>
       <option value="Pastel carne com queijo">Pastel carne com queijoï¼ˆç‰›ï¼‹ãƒãƒ¼ã‚ºï¼‰</option>
       <option value="Pastel frango com queijo">Pastel frango com queijoï¼ˆé¶ï¼‹ãƒãƒ¼ã‚ºï¼‰</option>
       <option value="Pastel de frango com catupiry">Pastel de frango com catupiryï¼ˆé¶ï¼‹ã‚«ãƒˆã‚¥ãƒ”ãƒªï¼‰</option>
       <option value="Pastel de palmito">Pastel de palmitoï¼ˆãƒ¤ã‚·ã®èŠ½ï¼‰</option>
       <option value="Pastel de carne seca com queijo">Pastel de carne seca com queijoï¼ˆå¹²ã—è‚‰ï¼‹ãƒãƒ¼ã‚ºï¼‰</option>
       <option value="Pastel de costela">Pastel de costelaï¼ˆã‚¹ãƒšã‚¢ãƒªãƒ–ï¼‰</option>
       <option value="Alcatra bife">Alcatra bifeï¼ˆã‚¢ãƒ«ã‚«ãƒˆãƒ©ãƒ»ã‚¹ãƒ†ãƒ¼ã‚­ï¼‰</option>
       <option value="Alcatra cubo">Alcatra cuboï¼ˆã‚¢ãƒ«ã‚«ãƒˆãƒ©ãƒ»è§’åˆ‡ã‚Šï¼‰</option>
       <option value="Bananinha">Bananinhaï¼ˆãƒãƒŠãƒ‹ãƒ¼ãƒ‹ãƒ£ï¼‰</option>
       <option value="Bife a milanesa">Bife a milanesaï¼ˆãƒŸãƒ©ãƒãƒ¼ã‚¶ï¼‰</option>
       <option value="Tulipa frita">Tulipa fritaï¼ˆãƒ•ãƒ©ã‚¤ãƒ‰æ‰‹ç¾½ä¸­ï¼‰</option>
       <option value="coraÃ§Ã£o de frango">coraÃ§Ã£o de frangoï¼ˆé¶ãƒãƒ„ï¼‰</option>
       <option value="tulipa churrasco">tulipa churrascoï¼ˆãƒãƒ¥ãƒªãƒƒãƒ‘ãƒ»ç„¼ãï¼‰</option>
     </select>

     <label for="dateMade">Data(æ—¥ä»˜)</label><br>
     <input type="date" id="dateMade" style="width: 100%; padding: 10px; margin-bottom: 10px;" value="" />

     <label for="creatorName">Nome(æ®µå–è€…)</label><br>
     <select id="creator" style="width: 100%; padding: 10px; margin-bottom: 10px;" >
       <option value="Paulo">Paulo</optiono>
      <option value="Hana">Hana</optiono>
      <option value="Pri">Pri</optiono>
      <option value="Cris">Cris</optiono>
      <option value="Hayate">Hayate</optiono>
      </select>
     <!-- <input type="text" id="creatorName" placeholder="ä¾‹: Paulo" style="width: 100%; padding: 10px; margin-bottom: 10px;" /> -->

     <label for="labelCount">Quantidade(æšæ•°)</label><br>
     <input type="number" id="labelCount" value="1" min="1" style="width: 100%; padding: 10px; margin-bottom: 10px;" />

     <button onclick="submitPastelLabel()" style="width: 100%; padding: 12px;">ğŸ–¨ï¸ Imprimir(å°åˆ·)</button>
   </div>
    </div>



   <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
   <div class="overlay" id="overlay" onclick="closeModal()"></div>
   <div class="modal" id="modal">
     <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ä¸­èº«ï¼ˆ.modal-contentï¼‰ã‚’æ›¸ãæ›ãˆ -->
<div class="modal-content">
  <p>Escolha a quantidade</p>
  <p>æšæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
  <div id="displayCount" style="font-size: 32px; margin-bottom: 15px;">0</div>
  <div class="keypad">
    <button onclick="addDigit(1)">1</button>
    <button onclick="addDigit(2)">2</button>
    <button onclick="addDigit(3)">3</button>
    <button onclick="addDigit(4)">4</button>
    <button onclick="addDigit(5)">5</button>
    <button onclick="addDigit(6)">6</button>
    <button onclick="addDigit(7)">7</button>
    <button onclick="addDigit(8)">8</button>
    <button onclick="addDigit(9)">9</button>
    <button onclick="clearCount()">â†</button>
    <button onclick="addDigit(0)">0</button>
    <button onclick="setCount('0')">C</button>
  </div>
  <br>
  <button onclick="printLabel()"> Imprimir(å°åˆ·)</button>
  <button onclick="closeModal()">Cancelalr(ã‚­ãƒ£ãƒ³ã‚»ãƒ«)</button>
</div>

   </div>
   <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>

   <script>

   const token = window.localStorage.getItem('token');

   if (!token) {
      window.location.href = '../index.html';
   }
   const decodedToken = jwt_decode(token); // jwtDecodeã§ã¯ãªãjwt_decodeã‚’ä½¿ç”¨

   let clients ={
     id:decodedToken.userId, //ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆid
     language:decodedToken.language, //ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨€èª
     paytype:'',ã€€//ãƒ¦ãƒ¼ã‚¶ãƒ¼æ”¯æ‰•ã„æ–¹æ³•
     selectedOrder:"",ã€€//é¸æŠã‚ªãƒ¼ãƒ€ãƒ¼
     printInfo:"",ã€€//ï¼Ÿï¼Ÿ
     taxtType:"",ã€€//ç¨é‡‘åŒºåˆ†
     registerInfo:"",
     salesInfo:"", //ã‚»ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿
     kubun:decodedToken.role,ã€€//admin or operator
     table_count:decodedToken.table_count,
     takeout_enabled:decodedToken.takeout_enabled,
     uber_enabled:decodedToken.uber_enabled,
     tax_use:decodedToken.tax_enabled,
     invoice_number:decodedToken.invoice_number,
     pendingOrders:null,
     receipt_display_name:decodedToken.receipt_display_name,
     receipt_postal_code:decodedToken.receipt_postal_code,
     receipt_address:decodedToken.receipt_address,
     receipt_tel:decodedToken.receipt_tel,
     tax_type:decodedToken.tax_type,
     regiterCaixa:0

   }
   console.log(clients)

   if(clients.id === 17){

   }
     const labelContainer = document.getElementById('labelContainer');
     const overlay = document.getElementById('overlay');
     const modal = document.getElementById('modal');
     const countInput = document.getElementById('countInput');
     let selectedImageUrl = '';

     for (let i = 1; i <= 12; i++) {
       const url = `https://orders-image.sgp1.digitaloceanspaces.com/labelsRoots/label${i}.png`;
       const div = document.createElement('div');
       div.className = 'label-item';
       div.innerHTML = `<img src="${url}" alt="label${i}">`;
       div.onclick = () => {
         selectedImageUrl = url;
         overlay.style.display = 'block';
         modal.style.display = 'flex';
       };
       labelContainer.appendChild(div);
     }

     function closeModal() {
       overlay.style.display = 'none';
       modal.style.display = 'none';
     }


const labelContainerSweet = document.getElementById('labelContainer-sweet');

for (let i = 1; i <= 12; i++) {
  const url = `https://orders-image.sgp1.digitaloceanspaces.com/labelsRoots/desert/${i}.png`;

  const img = document.createElement('img');
  img.src = url;
  img.alt = `label ${i}`;
  img.style.width = '150px';
  img.style.height = '100px';
  img.style.objectFit = 'contain';
  img.style.background = '#fff';

  const div = document.createElement('div');
  div.className = 'label-item';
  div.appendChild(img);

  // å¿…è¦ã§ã‚ã‚Œã°ã€ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å°åˆ·é¸æŠãªã©ã‚‚è¿½åŠ ã§ãã‚‹
  div.onclick = () => {
    selectedImageUrl = url;
    overlay.style.display = 'block';
    modal.style.display = 'flex';
  };

  labelContainerSweet.appendChild(div);
}





     async function printLabel() {
  const count = parseInt(currentCount || '0');
  if (count <= 0) return alert("1æšä»¥ä¸Šã‚’æŒ‡å®šã—ã¦ãã ã•ã„");

  try {
    const res = await fetch('http://localhost:3001/print-label', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        imageUrl: selectedImageUrl,
        count
      })
    });
    const data = await res.json();
    // if (data.success) {
    //   alert('ğŸ–¨ï¸ å°åˆ·ã‚’é–‹å§‹ã—ã¾ã—ãŸ');
    // } else {
    //   alert('âŒ å°åˆ·å¤±æ•—: ' + data.error);
    // }
  } catch (e) {
    alert('âš ï¸ é€šä¿¡ã‚¨ãƒ©ãƒ¼: ' + e.message);
  }

  closeModal();
}

     let currentCount = '';

function addDigit(num) {
  if (currentCount.length < 3) {
    currentCount += num.toString();
    updateDisplay();
  }
}

function clearCount() {
  currentCount = currentCount.slice(0, -1);
  updateDisplay();
}

function setCount(val) {
  currentCount = val;
  updateDisplay();
}

function updateDisplay() {
  document.getElementById('displayCount').innerText = currentCount || '0';
}

// æ—¥ä»˜ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ä»Šæ—¥ã«
 document.addEventListener('DOMContentLoaded', () => {
   const today = new Date().toISOString().split('T')[0];
   document.getElementById('dateMade').value = today;
 });

 async function submitPastelLabel() {
   const itemName = document.getElementById('itemName').value;
   const date = document.getElementById('dateMade').value;
   const creator = document.getElementById('creator').value.trim();
   const count = parseInt(document.getElementById('labelCount').value);

   if (!itemName || !date || !creator || count <= 0) {
     alert('å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
     return;
   }

   try {
     const res = await fetch('http://localhost:3001/print-custom-label', {
       method: 'POST',
       headers: { 'Content-Type': 'application/json' },
       body: JSON.stringify({ itemName, date, creator, count })
     });
     const result = await res.json();
     // if (result.success) {
     //   alert("âœ… å°åˆ·ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†");
     // } else {
     //   alert("âŒ å°åˆ·ã‚¨ãƒ©ãƒ¼: " + result.error);
     // }
   } catch (e) {
     alert("âš ï¸ é€šä¿¡ã‚¨ãƒ©ãƒ¼: " + e.message);
   }
 }

// function printLabel() {
//   const count = parseInt(currentCount || '0');
//   if (count <= 0) return alert("1æšä»¥ä¸Šã‚’æŒ‡å®šã—ã¦ãã ã•ã„");
//   for (let i = 0; i < count; i++) {
//     const win = window.open('', '_blank');
//     win.document.write(`<img src="${selectedImageUrl}" onload="window.print(); window.close();" style="width:300px;" />`);
//   }
//   closeModal();
// }

   </script>


    <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
    <script src="../script/translations.js"></script>
    <script src="../script/loding-popup.js"></script>
    <script src="../config.js"></script>
    <script src="../script/comandas.js"></script> <!-- Link to your JavaScript file -->
    <script src="../script/common.js"></script>
</body>
</html>
